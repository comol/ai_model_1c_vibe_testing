// Процедура для получения всех групп справочника Номенклатура с уровнями иерархии
// Использует рекурсивный запрос для обхода неограниченной иерархии
Процедура ПолучитьГруппыИУровни()

    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |	СправочникНоменклатура.Ссылка КАК Группа,
    |	СправочникНоменклатура.Родитель КАК Родитель,
    |	0 КАК Уровень
    |ПОМЕСТИТЬ Рекурсия
    |ИЗ
    |	Справочник.Номенклатура КАК СправочникНоменклатура
    |ГДЕ
    |	СправочникНоменклатура.Родитель = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
    |	И СправочникНоменклатура.ЭтоГруппа
    |
    |ОБЪЕДИНИТЬ ВСЕ
    |
    |ВЫБРАТЬ
    |	СправочникНоменклатура.Ссылка,
    |	СправочникНоменклатура.Родитель,
    |	Рекурсия.Уровень + 1
    |ИЗ
    |	Справочник.Номенклатура КАК СправочникНоменклатура
    |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Рекурсия КАК Рекурсия
    |		ПО СправочникНоменклатура.Родитель = Рекурсия.Группа
    |ГДЕ
    |	СправочникНоменклатура.ЭтоГруппа
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    |	Рекурсия.Группа КАК Группа,
    |	Рекурсия.Уровень КАК Уровень
    |ИЗ
    |	Рекурсия КАК Рекурсия";

    Выборка = Запрос.Выполнить().Выбрать();

    Пока Выборка.Следующий() Цикл
    	// Здесь обработка: Группа = Выборка.Группа, Уровень = Выборка.Уровень
    	// (например, добавление в таблицу значений или массив; без вывода сообщений)
    КонецЦикла;

КонецПроцедуры