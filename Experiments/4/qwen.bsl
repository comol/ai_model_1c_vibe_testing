// Запрос для получения всех групп номенклатуры с указанием уровня иерархии
// Используется в языке запросов 1С

Запрос = Новый Запрос;
Запрос.Текст = 
"ВЫБРАТЬ
|	Номенклатура.Ссылка КАК Ссылка,
|	Номенклатура.Наименование КАК Наименование,
|	Номенклатура.Родитель КАК Родитель,
|	Номенклатура.ЭтоГруппа КАК ЭтоГруппа
|ИЗ
|	Справочник.Номенклатура КАК Номенклатура
|ГДЕ
|	Номенклатура.ЭтоГруппа = Истина
|УПОРЯДОЧИТЬ ПО
|	Номенклатура.Наименование";

// Выполняем запрос
РезультатЗапроса = Запрос.Выполнить().Выбрать();

// Создаем таблицу значений для результата с уровнями иерархии
ТаблицаРезультата = Новый ТаблицаЗначений;
ТаблицаРезультата.Колонки.Добавить("Наименование");
ТаблицаРезультата.Колонки.Добавить("Уровень");
ТаблицаРезультата.Колонки.Добавить("Ссылка");

Пока РезультатЗапроса.Следующий() Цикл
	// Определяем уровень иерархии для текущей группы
	Уровень = 0;
	ТекущийЭлемент = РезультатЗапроса.Ссылка;
	
	// Поднимаемся по иерархии до корня, считая уровни
	Пока ТекущийЭлемент.ПолучитьОбъект().Родитель <> Неопределено Цикл
		ТекущийЭлемент = ТекущийЭлемент.ПолучитьОбъект().Родитель;
		Уровень = Уровень + 1;
	КонецЦикла;
	
	// Добавляем строку в таблицу результата
	НоваяСтрока = ТаблицаРезультата.Добавить();
	НоваяСтрока.Наименование = РезультатЗапроса.Наименование;
	НоваяСтрока.Уровень = Уровень;
	НоваяСтрока.Ссылка = РезультатЗапроса.Ссылка;
КонецЦикла;

// Возвращаем таблицу с результатами
Возврат ТаблицаРезультата;
