// Запрос для получения актуальной цены всех товаров на заданную дату
// из непериодического регистра сведений "Цены товара"
// Параметры запроса:
//  &ДатаПоиска - дата, на которую нужно найти цены

Функция ПолучитьЗапросАктуальныхЦен()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Таблица.Номенклатура КАК Номенклатура,
	|	МАКСИМУМ(Таблица.Дата) КАК Дата
	|ПОМЕСТИТЬ ВТМаксДаты
	|ИЗ
	|	РегистрСведений.ЦеныТовара КАК Таблица
	|ГДЕ
	|	Таблица.Дата <= &ДатаПоиска
	|СГРУППИРОВАТЬ ПО
	|	Таблица.Номенклатура;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Таблица.Номенклатура КАК Номенклатура,
	|	Таблица.Цена КАК Цена
	|ИЗ
	|	РегистрСведений.ЦеныТовара КАК Таблица
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТМаксДаты КАК МаксДаты
	|	ПО Таблица.Номенклатура = МаксДаты.Номенклатура
	|		И Таблица.Дата = МаксДаты.Дата";
	
	Возврат Запрос;
	
КонецФункции

// Пример использования:
// Запрос = ПолучитьЗапросАктуальныхЦен();
// Запрос.УстановитьПараметр("ДатаПоиска", Дата);
// Результат = Запрос.Выполнить();
// Выборка = Результат.Выбрать();
// Пока Выборка.Следующий() Цикл
//     Номенклатура = Выборка.Номенклатура;
//     Цена = Выборка.Цена;
//     // Обработка данных
// КонецЦикла;
