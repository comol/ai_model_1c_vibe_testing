&НаКлиенте
Процедура ДемонстрацияFIFO()
    // Создание таблицы значений с полями: Номенклатура, Количество, Сумма, Дата
    Таблица = Новый ТаблицаЗначений;
    Таблица.Колонки.Добавить("Номенклатура", Новый ОписаниеТипов("Строка"));
    Таблица.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
    Таблица.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число"));
    Таблица.Колонки.Добавить("Дата", Новый ОписаниеТипов("Дата"));

    // Тестовые данные (партии товара, упорядоченные по дате поступления)
    Строка = Таблица.Добавить();
    Строка.Номенклатура = "Товар1";
    Строка.Количество = 10;
    Строка.Сумма = 1000;
    Строка.Дата = Дата(2023, 1, 1);

    Строка = Таблица.Добавить();
    Строка.Номенклатура = "Товар1";
    Строка.Количество = 5;
    Строка.Сумма = 600;
    Строка.Дата = Дата(2023, 1, 5);

    Строка = Таблица.Добавить();
    Строка.Номенклатура = "Товар2";
    Строка.Количество = 8;
    Строка.Сумма = 800;
    Строка.Дата = Дата(2023, 1, 3);

    // Списание 12 единиц Товар1 методом FIFO
    Списано = СписатьТовар(Таблица, "Товар1", 12);
    Сообщить("Списано: " + Списано);

    // Вывод оставшихся партий Товар1 (для проверки)
    Для Каждого Строка Из Таблица Цикл
        Если Строка.Номенклатура = "Товар1" Тогда
            Сообщить("Остаток партии: " + Строка.Количество + " шт., Дата: " + Формат(Строка.Дата, "ДФ=dd.MM.yyyy"));
        КонецЕсли;
    КонецЦикла;
КонецПроцедуры

Функция СписатьТовар(Таблица, Номенклатура, Количество) Экспорт
    // Списание по принципу FIFO (первый пришел – первый ушел)
    // Возвращает фактически списанное количество (может быть меньше запрошенного)
    Оставшееся = Количество;

    // Сортируем партии по дате поступления (от старой к новой)
    Таблица.ОтсортироватьПоКолонке("Дата", Истина);

    Для Каждого Строка Из Таблица Цикл
        Если Строка.Номенклатура = Номенклатура И Оставшееся > 0 Тогда
            Если Строка.Количество <= Оставшееся Тогда
                // Партия полностью списана
                Оставшееся = Оставшееся - Строка.Количество;
                Таблица.Удалить(Строка);
            Иначе
                // Партия частично списана
                Строка.Количество = Строка.Количество - Оставшееся;
                Оставшееся = 0;
            КонецЕсли;
        КонецЕсли;
    КонецЦикла;

    Возврат Количество - Оставшееся;
КонецФункции
