// Демонстрация списания по FIFO
Процедура ДемонстрацияFIFO() Экспорт

    // Создание таблицы значений
    ТаблицаПартий = Новый ТаблицаЗначений;
    ТаблицаПартий.Колонки.Добавить("Номенклатура", Новый ОписаниеТипов("Строка"));
    ТаблицаПартий.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15, 3)));
    ТаблицаПартий.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15, 2)));
    ТаблицаПартий.Колонки.Добавить("Дата", Новый ОписаниеТипов("Дата"));

    // Заполнение тестовыми данными
    Строка = ТаблицаПартий.Добавить();
    Строка.Номенклатура = "Товар1";
    Строка.Количество = 10;
    Строка.Сумма = 100;
    Строка.Дата = '20230101';

    Строка = ТаблицаПартий.Добавить();
    Строка.Номенклатура = "Товар1";
    Строка.Количество = 5;
    Строка.Сумма = 60;
    Строка.Дата = '20230201';

    Строка = ТаблицаПартий.Добавить();
    Строка.Номенклатура = "Товар1";
    Строка.Количество = 8;
    Строка.Сумма = 88;
    Строка.Дата = '20230301';

    // Параметры списания
    НоменклатураСписать = "Товар1";
    КоличествоСписать = 15;

    // Списание по FIFO
    СписатьПоFIFO(ТаблицаПартий, НоменклатураСписать, КоличествоСписать);

    // Здесь можно добавить код для проверки результата, но по правилам без сообщений

КонецПроцедуры

// Процедура списания по методу FIFO
// Параметры:
//   ТаблицаПартий - ТаблицаЗначений - таблица с партиями
//   Номенклатура - Строка - номенклатура для списания
//   КоличествоСписать - Число - количество для списания
Процедура СписатьПоFIFO(ТаблицаПартий, Номенклатура, КоличествоСписать)

    // Сортировка по дате для FIFO (самые старые первыми)
    ТаблицаПартий.Сортировать("Дата Возр");

    // Отбор строк по номенклатуре
    Отбор = Новый Структура("Номенклатура", Номенклатура);
    Партии = ТаблицаПартий.НайтиСтроки(Отбор);

    Для Каждого Партия Из Партии Цикл

        Если КоличествоСписать <= 0 Тогда
            Прервать;
        КонецЕсли;

        Если Партия.Количество <= 0 Тогда
            Продолжить;
        КонецЕсли;

        СписываемоеКоличество = Мин(Партия.Количество, КоличествоСписать);

        // Пропорциональное списание суммы
        ЦенаЕдиницы = ?(Партия.Количество > 0, Партия.Сумма / Партия.Количество, 0);
        СписываемаяСумма = СписываемоеКоличество * ЦенаЕдиницы;

        Партия.Количество = Партия.Количество - СписываемоеКоличество;
        Партия.Сумма = Партия.Сумма - СписываемаяСумма;

        КоличествоСписать = КоличествоСписать - СписываемоеКоличество;

        // Удаление нулевой партии
        Если Партия.Количество = 0 Тогда
            ТаблицаПартий.Удалить(Партия);
        КонецЕсли;

    КонецЦикла;

КонецПроцедуры
