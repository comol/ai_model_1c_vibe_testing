// Код для формы элемента справочника с картинкой
// Предполагается, что в форме есть:
// - Декорация "Картинка" с видом "Картинка"
// - Реквизит "Картинка" типа "ХранилищеЗначения"

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	// Загружаем картинку из реквизита при открытии формы
	ЗагрузитьКартинкуИзРеквизита();
КонецПроцедуры

&НаКлиенте
Процедура КартинкаПриНажатии(Элемент)
	// При нажатии на картинку - выбираем новый файл
	ВыбратьИЗагрузитьКартинку();
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьКартинкуИзРеквизита()
	// Загружает картинку из реквизита "Картинка" в элемент формы
	Если Объект.Картинка = Неопределено Тогда
		// Если картинки нет, очищаем элемент
		Элементы.Картинка.Картинка = Неопределено;
		Возврат;
	КонецЕсли;
	
	Попытка
		// Создаем поток из хранилища значения
		Поток = Новый ПотокВПамяти;
		Поток.Записать(Объект.Картинка.ПолучитьДвоичныеДанные());
		Поток.Позиция = 0;
		
		// Создаем картинку из потока
		Картинка = Новый Картинка(Поток);
		Элементы.Картинка.Картинка = Картинка;
		
	Исключение
		// В случае ошибки очищаем картинку
		Элементы.Картинка.Картинка = Неопределено;
	КонецПопытки;
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьИЗагрузитьКартинку()
	// Выбираем файл картинки и загружаем его в реквизит
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Диалог.ПолеТекста = "Выберите файл изображения";
	Диалог.Фильтр = "Изображения|*.jpg;*.jpeg;*.png;*.bmp;*.gif;*.ico|Все файлы|*.*";
	
	Если Диалог.Выбрать() Тогда
		Попытка
			// Читаем выбранный файл
			Файл = Новый Файл(Диалог.ПолноеИмяФайла);
			Если Не Файл.Существует() Тогда
				Возврат;
			КонецЕсли;
			
			// Создаем двоичные данные из файла
			ДвоичныеДанные = Новый ДвоичныеДанные(Диалог.ПолноеИмяФайла);
			
			// Создаем хранилище значения
			Хранилище = Новый ХранилищеЗначения(ДвоичныеДанные);
			
			// Сохраняем в реквизит объекта
			Объект.Картинка = Хранилище;
			
			// Обновляем картинку на форме
			ЗагрузитьКартинкуИзРеквизита();
			
			// Помечаем объект как измененный
			Элементы.Картинка.ИзменениеНаличияДанных = Истина;
			
		Исключение
			ПоказатьПредупреждение("Ошибка при загрузке картинки: " + ОписаниеОшибки());
		КонецПопытки;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьКартинку()
	// Очищает картинку из реквизита и формы
	Объект.Картинка = Неопределено;
	Элементы.Картинка.Картинка = Неопределено;
	Элементы.Картинка.ИзменениеНаличияДанных = Истина;
КонецПроцедуры

// Дополнительная процедура для сохранения картинки на диск
&НаКлиенте
Процедура СохранитьКартинкуНаДиск()
	Если Объект.Картинка = Неопределено Тогда
		ПоказатьПредупреждение("Картинка не загружена");
		Возврат;
	КонецЕсли;
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);
	Диалог.ПолеТекста = "Сохранить изображение как";
	Диалог.Фильтр = "PNG файлы|*.png|JPEG файлы|*.jpg|Все файлы|*.*";
	Диалог.ПолноеИмяФайла = "image.png";
	
	Если Диалог.Выбрать() Тогда
		Попытка
			ДвоичныеДанные = Объект.Картинка.ПолучитьДвоичныеДанные();
			ДвоичныеДанные.Записать(Диалог.ПолноеИмяФайла);
			ПоказатьИнформацию("Картинка сохранена успешно");
		Исключение
			ПоказатьПредупреждение("Ошибка при сохранении картинки: " + ОписаниеОшибки());
		КонецПопытки;
	КонецЕсли;
КонецПроцедуры

// XML-конфигурация формы для примера
/*
<Form xmlns="http://v8.1c.ru/8.3/xcf/form" xmlns:dc="http://v8.1c.ru/8.3/xcf/dc" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
	<WindowOpeningMode>LockOwnerWindow</WindowOpeningMode>
	<AutoCommandBar name="ФормаКоманднаяПанель" id="-1"/>
	<Events>
		<Event name="OnOpen">ПриОткрытии</Event>
	</Events>
	<ChildItems>
		<InputField name="Наименование" id="1">
			<DataPath>Объект.Description</DataPath>
			<ContextMenu name="НаименованиеКонтекстноеМеню" id="2"/>
			<ExtendedTooltip name="НаименованиеРасширеннаяПодсказка" id="3"/>
		</InputField>
		
		<!-- Декорация для отображения картинки -->
		<Decoration name="Картинка" id="10">
			<DecorationType>Picture</DecorationType>
			<Width>10</Width>
			<Height>10</Height>
			<HorizontalAlign>Left</HorizontalAlign>
			<VerticalAlign>Top</VerticalAlign>
			<Border>
				<v8ui:style xsi:type="v8ui:ControlBorderType">Single</v8ui:style>
			</Border>
			<ContextMenu name="КартинкаКонтекстноеМеню" id="11"/>
			<ExtendedTooltip name="КартинкаРасширеннаяПодсказка" id="12"/>
			<Events>
				<Event name="Click">КартинкаПриНажатии</Event>
			</Events>
		</Decoration>
		
		<!-- Кнопка для очистки картинки -->
		<Button name="ОчиститьКартинку" id="20">
			<Type>UsualButton</Type>
			<CommandName>ОчиститьКартинку</CommandName>
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Очистить</v8:content>
				</v8:item>
			</Title>
			<ContextMenu name="ОчиститьКартинкуКонтекстноеМеню" id="21"/>
			<ExtendedTooltip name="ОчиститьКартинкуРасширеннаяПодсказка" id="22"/>
		</Button>
		
		<!-- Кнопка для сохранения картинки на диск -->
		<Button name="СохранитьКартинку" id="30">
			<Type>UsualButton</Type>
			<CommandName>СохранитьКартинку</CommandName>
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сохранить на диск</v8:content>
				</v8:item>
			</Title>
			<ContextMenu name="СохранитьКартинкуКонтекстноеМеню" id="31"/>
			<ExtendedTooltip name="СохранитьКартинкуРасширеннаяПодсказка" id="32"/>
		</Button>
	</ChildItems>
	<Attributes>
		<Attribute name="Объект" id="1">
			<Type>
				<v8:Type>cfg:CatalogObject.Номенклатура</v8:Type>
			</Type>
			<MainAttribute>true</MainAttribute>
			<SavedData>true</SavedData>
		</Attribute>
		<Attribute name="Картинка" id="2">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Картинка</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>v8ui:ValueStorage</v8:Type>
			</Type>
			<SavedData>true</SavedData>
			<MainAttribute>false</MainAttribute>
		</Attribute>
	</Attributes>
	<Commands>
		<Command name="ОчиститьКартинку" id="1">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Очистить картинку</v8:content>
				</v8:item>
			</Title>
			<ToolTip>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Очистить загруженную картинку</v8:content>
				</v8:item>
			</ToolTip>
			<Action>
				<xr:Item>
					<xr:Type>FormCommandHandler</xr:Type>
					<xr:Handler>ОчиститьКартинку</xr:Handler>
				</xr:Item>
			</Action>
		</Command>
		<Command name="СохранитьКартинку" id="2">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сохранить картинку</v8:content>
				</v8:item>
			</Title>
			<ToolTip>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сохранить картинку на диск</v8:content>
				</v8:item>
			</ToolTip>
			<Action>
				<xr:Item>
					<xr:Type>FormCommandHandler</xr:Type>
					<xr:Handler>СохранитьКартинкуНаДиск</xr:Handler>
				</xr:Item>
			</Action>
		</Command>
	</Commands>
</Form>
*/

// Примечание: для использования кода нужно:
// 1. Добавить в справочник реквизит "Картинка" типа "ХранилищеЗначения"
// 2. На форме элемента добавить декорацию "Картинка" с типом "Картинка"
// 3. Настроить обработчики событий в свойствах формы
// 4. Добавить команды для кнопок "Очистить" и "Сохранить"

// === ИНСТРУКЦИЯ ПО ВНЕДРЕНИЮ КОДА ДЛЯ РАБОТЫ С КАРТИНКОЙ В СПРАВОЧНИКЕ ===

/*
Шаг 1: Добавление реквизита в справочник
1. Откройте конфигуратор 1С
2. Перейдите к справочнику "Номенклатура" (или нужный справочник)
3. Добавьте новый реквизит:
   - Имя: Картинка
   - Тип: ХранилищеЗначения
   - Синоним: Картинка товара

Шаг 2: Настройка формы элемента
1. Откройте форму элемента справочника
2. Добавьте на форму элемент:
   - Тип: Декорация
   - Имя: Картинка
   - Вид: Картинка
   - Размеры: настройте по необходимости (например, 200x200)

Шаг 3: Добавление обработчиков событий
1. В свойствах формы добавьте обработчик события "ПриОткрытии"
   - Обработчик: ПриОткрытии
2. В свойствах декорации "Картинка" добавьте обработчик события "ПриНажатии"
   - Обработчик: КартинкаПриНажатии

Шаг 4: Добавление команд
1. Добавьте команду "Очистить картинку":
   - Имя команды: ОчиститьКартинку
   - Обработчик: ОчиститьКартинку
2. Добавьте команду "Сохранить картинку":
   - Имя команды: СохранитьКартинку
   - Обработчик: СохранитьКартинкуНаДиск

Шаг 5: Копирование кода
1. Скопируйте весь код из этого файла в модуль формы элемента
2. Сохраните изменения
3. Проверьте работу:
   - Откройте элемент справочника
   - Картинка должна загружаться автоматически
   - При нажатии на картинку должно открываться окно выбора файла

Дополнительные возможности:
- Код поддерживает все популярные форматы изображений (JPG, PNG, BMP, GIF, ICO)
- Картинка сохраняется в базе данных в виде двоичных данных
- Есть возможность очистки картинки
- Есть возможность сохранения картинки на диск

Пример использования в коде:
// Проверка наличия картинки
Если Объект.Картинка <> Неопределено Тогда
    // Работа с картинкой
КонецЕсли;

// Получение размера картинки
Если Объект.Картинка <> Неопределено Тогда
    Данные = Объект.Картинка.ПолучитьДвоичныеДанные();
    Размер = Данные.Размер();
КонецЕсли;
*/
