&НаСервере
// Обработчик события "При создании на сервере".
// Выполняется один раз при открытии формы.
//
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	// Если в реквизите "Картинка" объекта есть данные, то получаем их,
	// помещаем во временное хранилище и записываем адрес в реквизит формы "АдресКартинки".
	// Платформа автоматически отобразит картинку по этому адресу в декорации на форме.
	Если ЗначениеЗаполнено(Объект.Картинка) Тогда
		
		АдресКартинки = ПоместитьВоВременноеХранилище(Объект.Картинка.Получить(), УникальныйИдентификатор);
		
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
// Обработчик события "Нажатие" для декорации-картинки "Картинка".
//
Процедура КартинкаНажатие(Элемент)

	// Создаем описание оповещения, которое будет вызвано после выбора файла.
	// Указываем, что нужно вызвать процедуру "ЗагрузитьКартинкуЗавершение" этого модуля формы.
	ОписаниеОповещения = Новый ОписаниеОповещения("ЗагрузитьКартинкуЗавершение", ЭтотОбъект);

	// Открываем диалог выбора файла в асинхронном режиме.
	НачатьПомещениеФайла(ОписаниеОповещения, , , Истина, УникальныйИдентификатор);

КонецПроцедуры

&НаКлиенте
// Асинхронная процедура-обработчик. Вызывается после того, как пользователь выбрал файл.
//
// Параметры:
//  Результат               - Структура - результат помещения файла или Неопределено, если выбор был отменен.
//  ДополнительныеПараметры - Произвольный  - значение, которое было передано при создании оповещения.
//
Процедура ЗагрузитьКартинкуЗавершение(Результат, ДополнительныеПараметры) Экспорт

	// Если пользователь отменил выбор файла или произошла ошибка, выходим.
	Если Результат = Неопределено ИЛИ НЕ Результат.Успешно Тогда
		
		Возврат;
		
	КонецЕсли;

	// Записываем адрес новой картинки в реквизит формы.
	// Картинка на форме сразу обновится.
	АдресКартинки = Результат.АдресХранилища;

	// Устанавливаем флаг, что форма была изменена.
	Модифицированность = Истина;

	// Вызываем серверную процедуру для сохранения картинки в реквизите объекта.
	ЗаписатьКартинкуНаСервере(Результат.АдресХранилища);

КонецПроцедуры

&НаСервере
// Сохраняет двоичные данные картинки из временного хранилища в реквизит "Картинка" объекта.
//
// Параметры:
//  АдресКартинкиВХранилище - Строка - адрес двоичных данных картинки во временном хранилище.
//
Процедура ЗаписатьКартинкуНаСервере(АдресКартинкиВХранилище)

	// Получаем двоичные данные картинки из временного хранилища.
	ДвоичныеДанные = ПолучитьИзВременногоХранилища(АдресКартинкиВХранилище);

	// Создаем новое хранилище значения из двоичных данных с максимальным сжатием
	// и записываем его в реквизит "Картинка" объекта.
	Объект.Картинка = Новый ХранилищеЗначения(ДвоичныеДанные, Новый СжатиеДанных(9));

КонецПроцедуры