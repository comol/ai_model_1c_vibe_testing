// Выгрузка справочника "Номенклатура" в XML файл

Процедура ВыгрузитьНоменклатуруВФайл(ПутьКФайлу)
	
	ЗаписьXML = Новый ЗаписьXML;
	ЗаписьXML.ОткрытьФайл(ПутьКФайлу, "UTF-8");
	
	ЗаписьXML.ЗаписатьНачалоДокумента();
	ЗаписьXML.ЗаписатьНачалоЭлемента("Номенклатура");
	
	Выборка = Справочники.Номенклатура.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		ЗаписьXML.ЗаписатьНачалоЭлемента("Элемент");
		
		// Идентификатор
		ЗаписьXML.ЗаписатьАтрибут("Ссылка", Выборка.Ссылка.УникальныйИдентификатор());
		
		// Наименование
		ЗаписьXML.ЗаписатьАтрибут("Наименование", Выборка.Наименование);
		
		// Дополнительные реквизиты можно добавить аналогично
		// Например:
		// ЗаписьXML.ЗаписатьАтрибут("Артикул", Выборка.Артикул);
		
		ЗаписьXML.ЗаписатьКонецЭлемента();
		
	КонецЦикла;
	
	ЗаписьXML.ЗаписатьКонецЭлемента();
	ЗаписьXML.ЗаписатьКонецДокумента();
	ЗаписьXML.Закрыть();
	
	Сообщить("Выгрузка завершена: " + ПутьКФайлу);
	
КонецПроцедуры
   Процедура ЗагрузитьНоменклатуруИзФайла(ПутьКФайлу)
	
	ЧтениеXML = Новый ЧтениеXML;
	ЧтениеXML.ОткрытьФайл(ПутьКФайлу);
	
	Если ЧтениеXML.Прочитать() = Неопределено Тогда
		ВызватьИсключение "Ошибка чтения файла.";
	КонецЕсли;
	
	Пока ЧтениеXML.ИмяУзла = "Элемент" Цикл
		
		Ссылка = Новый УникальныйИдентификатор(ЧтениеXML.ПолучитьАтрибут("Ссылка"));
		Наименование = ЧтениеXML.ПолучитьАтрибут("Наименование");
		
		// Проверяем, существует ли элемент с таким ИД
		НайденнаяСтрока = Справочники.Номенклатура.НайтиПоКоду(Ссылка);
		
		Если НайденнаяСтрока.Пустая() Тогда
			// Создаем новый элемент
			НовыйЭлемент = Справочники.Номенклатура.СоздатьЭлемент();
			НовыйЭлемент.Наименование = Наименование;
			// НовыйЭлемент.Код = Ссылка; // если используется код как ИД
			НовыйЭлемент.Записать();
		Иначе
			// Обновляем существующий
			НайденнаяСтрока.Наименование = Наименование;
			НайденнаяСтрока.Записать();
		КонецЕсли;
		
		ЧтениеXML.Прочитать();
		
	КонецЦикла;
	
	ЧтениеXML.Закрыть();
	
	Сообщить("Загрузка завершена.");
	
КонецПроцедуры
