// Общий модуль: ОбменНоменклатурой
// Назначение: Выгрузка/загрузка элементов справочника "Номенклатура" между идентичными конфигурациями в формате XML.

Процедура ВыгрузитьНоменклатуруВФайл(ПутьКФайлу) Экспорт
	// Выгружает все группы и элементы справочника Номенклатура в указанный XML-файл.

	ЗаписьXML = Новый ЗаписьXML;
	ЗаписьXML.ОткрытьФайл(ПутьКФайлу, "UTF-8", Истина);
	ЗаписьXML.ЗаписатьОбъявлениеXML();
	ЗаписьXML.ЗаписатьНачалоЭлемента("NomenclatureExport");

	Сериализатор = Новый СериализаторXDTO();

	Выборка = Справочники.Номенклатура.ВыбратьИерархически();
	Пока Выборка.Следующий() Цикл

		ОбъектНоменклатуры = Выборка.Ссылка.ПолучитьОбъект();

		// Записываем объект как XML-значение платформы
		Сериализатор.ЗаписатьXML(ЗаписьXML, ОбъектНоменклатуры);

	КонецЦикла;

	ЗаписьXML.ЗаписатьКонецЭлемента();
	ЗаписьXML.Закрыть();
КонецПроцедуры


Процедура ЗагрузитьНоменклатуруИзФайла(ПутьКФайлу) Экспорт
	// Загружает группы и элементы справочника Номенклатура из XML-файла и записывает их в базу.
	// Включается режим загрузки для сохранения идентификаторов (GUID).

	ЧтениеXML = Новый ЧтениеXML;
	ЧтениеXML.ОткрытьФайл(ПутьКФайлу);

	Сериализатор = Новый СериализаторXDTO();

	Пока ЧтениеXML.Прочитать() Цикл

		Если ЧтениеXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда

			Если Сериализатор.ВозможностьЧтенияXML(ЧтениеXML) Тогда

				ЗначениеИзXML = Сериализатор.ПрочитатьXML(ЧтениеXML);

				Если ТипЗнч(ЗначениеИзXML) = Тип("СправочникОбъект.Номенклатура") Тогда

					Объект = ЗначениеИзXML;

				ИначеЕсли ТипЗнч(ЗначениеИзXML) = Тип("СправочникСсылка.Номенклатура") Тогда

					Объект = ЗначениеИзXML.ПолучитьОбъект();

				Иначе

					Продолжить;

				КонецЕсли;

				Объект.ОбменДанными.Загрузка = Истина;

				Объект.Записать();

			КонецЕсли;

		КонецЕсли;

	КонецЦикла;

	ЧтениеXML.Закрыть();
КонецПроцедуры