#Область ОбработчикиСобытийФормы

&amp;НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&amp;НаКлиенте
Процедура Выгрузить(Команда)
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);
	Диалог.Заголовок = &quot;Выберите файл для выгрузки номенклатуры&quot;;
	Диалог.Фильтр = &quot;XML файлы (*.xml)|*.xml&quot;;
	Диалог.ПолноеИмяФайла = &quot;Номенклатура.xml&quot;;
	
	Если Диалог.Выбрать() Тогда
		Адрес = ВыгрузитьНоменклатуруНаСервере();
		НачатьПолучениеФайлаССервера(Адрес, Диалог.ПолноеИмяФайла, Новый ПараметрыДиалогаПолученияФайлов(&quot;Сохранить выгрузку&quot;, Истина));
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&amp;НаСервере
Функция ВыгрузитьНоменклатуруНаСервере()
	
	ИмяВременногоФайла = ПолучитьИмяВременногоФайла(&quot;xml&quot;);
	
	ЗаписьXML = Новый ЗаписьXML;
	ЗаписьXML.ОткрытьФайл(ИмяВременногоФайла);
	ЗаписьXML.ЗаписатьОбъявлениеXML();
	ЗаписьXML.ЗаписатьНачалоЭлемента(&quot;Данные&quot;);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	&quot;ВЫБРАТЬ
	|	Номенклатура.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.Номенклатура КАК Номенклатура
	|ГДЕ
	|	НЕ Номенклатура.ПометкаУдаления&quot;;
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		ОбъектСправочника = Выборка.Ссылка.ПолучитьОбъект();
		СериализаторXDTO.ЗаписатьXML(ЗаписьXML, ОбъектСправочника);
	КонецЦикла;
	
	ЗаписьXML.ЗаписатьКонецЭлемента();
	ЗаписьXML.Закрыть();
	
	ДвоичныеДанные = Новый ДвоичныеДанные(ИмяВременногоФайла);
	Адрес = ПоместитьВоВременноеХранилище(ДвоичныеДанные);
	
	УдалитьФайлы(ИмяВременногоФайла);
	
	Возврат Адрес;
	
КонецФункции

#КонецОбласти
