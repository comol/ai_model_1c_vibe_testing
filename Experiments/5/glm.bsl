Функция ПолучитьКурсДоллараЗаГод() Экспорт
    // Создаем таблицу значений для хранения курсов
    ТаблицаКурсов = Новый ТаблицаЗначений;
    ТаблицаКурсов.Колонки.Добавить("Дата", Новый ОписаниеТипов("Дата"));
    ТаблицаКурсов.Колонки.Добавить("Курс", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(10, 4)));
    
    // Определяем период: последний год
    ДатаКонца = ТекущаяДата();
    ДатаНачала = ДобавитьМесяц(ДатаКонца, -12);
    
    // Форматируем даты для URL (ДД/ММ/ГГГГ)
    ФорматДаты = "ДФ=dd/MM/yyyy";
    URLНачало = Формат(ДатаНачала, ФорматДаты);
    URLКонец = Формат(ДатаКонца, ФорматДаты);
    
    // Формируем URL запроса (код доллара США - R01235)
    URL = "https://www.cbr.ru/scripts/XML_dynamic.asp?date_req1=" + URLНачало + 
          "&date_req2=" + URLКонец + "&VAL_NM_RQ=R01235";
    
    // Выполняем HTTP-запрос
    Попытка
        HTTP = Новый HTTPСоединение("www.cbr.ru", 443, , , , , Новый ЗащищенноеСоединениеOpenSSL);
        HTTPЗапрос = Новый HTTPЗапрос(URL);
        Ответ = HTTP.Получить(HTTPЗапрос);
        
        // Проверяем успешность запроса
        Если Ответ.КодСостояния <> 200 Тогда
            ВызватьИсключение "Ошибка HTTP: " + Ответ.КодСостояния;
        КонецЕсли;
        
        // Читаем XML-ответ
        ЧтениеXML = Новый ЧтениеXML;
        ЧтениеXML.УстановитьСтроку(Ответ.ПолучитьТелоКакСтроку());
        
        // Парсим XML
        Пока ЧтениеXML.Прочитать() Цикл
            Если ЧтениеXML.ТипУзла = ТипУзлаXML.НачалоЭлемента И ЧтениеXML.Имя = "Record" Тогда
                НоваяСтрока = ТаблицаКурсов.Добавить();
                
                // Читаем атрибуты элемента Record
                Пока ЧтениеXML.ПрочитатьАтрибут() Цикл
                    Если ЧтениеXML.Имя = "Date" Тогда
                        // Преобразуем дату из формата ДД.ММ.ГГГГ
                        ДатаСтрока = СтрЗаменить(ЧтениеXML.Значение, ".", "");
                        НоваяСтрока.Дата = Дата(Сред(ДатаСтрока, 5, 4) + 
                                               Сред(ДатаСтрока, 3, 2) + 
                                               Сред(ДатаСтрока, 1, 2));
                    КонецЕсли;
                КонецЦикла;
                
                // Читаем вложенные элементы
                Пока ЧтениеXML.Прочитать() Цикл
                    Если ЧтениеXML.ТипУзла = ТипУзлаXML.КонецЭлемента И ЧтениеXML.Имя = "Record" Тогда
                        Прервать;
                    ИначеЕсли ЧтениеXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
                        ИмяЭлемента = ЧтениеXML.Имя;
                        ЧтениеXML.Прочитать();
                        Значение = ЧтениеXML.Значение;
                        
                        Если ИмяЭлемента = "Value" Тогда
                            // Заменяем запятую на точку и конвертируем в число
                            НоваяСтрока.Курс = Число(СтрЗаменить(Значение, ",", "."));
                        КонецЕсли;
                    КонецЕсли;
                КонецЦикла;
            КонецЕсли;
        КонецЦикла;
        
        ЧтениеXML.Закрыть();
        
    Исключение
        Сообщить("Ошибка при загрузке курсов: " + ОписаниеОшибки());
        Возврат Неопределено;
    КонецПопытки;
    
    Возврат ТаблицаКурсов;
КонецФункции