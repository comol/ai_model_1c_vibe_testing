&НаСервере
Функция ПолучитьКурсыДоллараЗаПоследнийГод() Экспорт
	// Возвращает ТаблицаЗначений: Дата (Дата), Курс (Число 15.4).
	// Источник: CBR SXML XML_dynamic.asp (USD = VAL_NM_RQ=R01235).

	ДатаОкончания = НачалоДня(ТекущаяДатаСеанса());
	ДатаНачала = НачалоДня(ДобавитьМесяц(ДатаОкончания, -12));

	ФорматДаты = "ДФ=dd/MM/yyyy";
	СтрокаДатыНач = Формат(ДатаНачала, ФорматДаты);
	СтрокаДатыКон = Формат(ДатаОкончания, ФорматДаты);

	Таблица = Новый ТаблицаЗначений;
	Таблица.Колонки.Добавить("Дата", Новый ОписаниеТипов(Тип("Дата")));
	Таблица.Колонки.Добавить("Курс", Новый ОписаниеТипов(Тип("Число"), , , Новый КвалификаторыЧисла(15, 4)));

	Соединение = СоздатьЗащищенноеСоединениеЦБ(10);
	Если Соединение = Неопределено Тогда
		Возврат Таблица;
	КонецЕсли;

	Путь = "/scripts/XML_dynamic.asp?date_req1=" + СтрокаДатыНач + "&date_req2=" + СтрокаДатыКон + "&VAL_NM_RQ=R01235";
	Ответ = Соединение.Get(Новый HTTPЗапрос(Путь));

	Если Ответ.КодСостояния <> 200 Тогда
		Возврат Таблица;
	КонецЕсли;

	ТелоXML = Ответ.ПолучитьТелоКакСтроку("windows-1251");

	Чтение = Новый ЧтениеXML;
	Чтение.УстановитьСтроку(ТелоXML);

	Построитель = Новый ПостроительDOM;
	Документ = Построитель.Прочитать(Чтение);
	Корень = Документ.ЭлементДокумента; // ValCurs

	Если Корень = Неопределено Тогда
		Возврат Таблица;
	КонецЕсли;

	Записи = Корень.ПолучитьЭлементыПоИмени("*", "Record");

	Для Каждого Узел Из Записи Цикл

		СтрокаДаты = Узел.ПолучитьАтрибут("Date");
		Если СтрокаДаты = Неопределено Тогда
			Продолжить;
		КонецЕсли;

		СтрокаНоминала = Узел.ПолучитьАтрибут("Nominal");
		Номинал = ?(СтрокаНоминала = Неопределено, 1, Число(СтрокаНоминала));

		ЭлементыЗначения = Узел.ПолучитьЭлементыПоИмени("*", "Value");
		Если ЭлементыЗначения.Количество() = 0 Тогда
			Продолжить;
		КонецЕсли;

		СтрокаКурса = ЭлементыЗначения[0].ТекстовоеСодержимое;
		СтрокаКурса = СтрЗаменить(СтрокаКурса, " ", "");
		СтрокаКурса = СтрЗаменить(СтрокаКурса, ",", ".");

		Курс = Число(СтрокаКурса);
		Если Номинал <> 0 Тогда
			Курс = Курс / Номинал;
		КонецЕсли;

		// Преобразуем dd.MM.yyyy -> Дата
		ДатаКотировки = Дата(Сред(СтрокаДаты, 7, 4), Сред(СтрокаДаты, 4, 2), Лев(СтрокаДаты, 2));

		СтрокаТаблицы = Таблица.Добавить();
		СтрокаТаблицы.Дата = НачалоДня(ДатаКотировки);
		СтрокаТаблицы.Курс = Курс;

	КонецЦикла;

	Возврат Таблица;
КонецФункции

Функция СоздатьЗащищенноеСоединениеЦБ(ТаймаутСекунд) Экспорт
	// HTTPS к www.cbr.ru через OpenSSL с корневыми сертификатами ОС Windows и заданным таймаутом.
	ЗащищенноеСоединение = Новый ЗащищенноеСоединениеOpenSSL(Неопределено, Новый СертификатыУдостоверяющихЦентровWindows());
	Возврат Новый HTTPСоединение("www.cbr.ru", , , , , ТаймаутСекунд, ЗащищенноеСоединение);
КонецФункции