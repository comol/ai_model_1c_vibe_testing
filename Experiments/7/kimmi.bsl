// Форма-источник данных с табличной частью "Товары"
// Первая форма для передачи данных во вторую форму

&НаКлиенте
Перем ТоварыДляПередачи;

// Инициализация формы
&НаКлиенте
Процедура ПриОткрытии(Отказ, СтандартнаяОбработка)
    // Инициализируем табличную часть примерами данных
    ИнициализироватьТовары();
КонецПроцедуры

// Инициализация табличной части товарами
&НаКлиенте
Процедура ИнициализироватьТовары()
    
    // Очищаем табличную часть
    Элементы.Товары.Очистить();
    
    // Добавляем примеры товаров
    НоваяСтрока = Элементы.Товары.Добавить();
    НоваяСтрока.Номер = 1;
    НоваяСтрока.Наименование = "Ноутбук Lenovo ThinkPad";
    НоваяСтрока.Количество = 2;
    НоваяСтрока.Цена = 45000;
    НоваяСтрока.Сумма = 90000;
    
    НоваяСтрока = Элементы.Товары.Добавить();
    НоваяСтрока.Номер = 2;
    НоваяСтрока.Наименование = "Монитор 24\" Dell";
    НоваяСтрока.Количество = 1;
    НоваяСтрока.Цена = 15000;
    НоваяСтрока.Сумма = 15000;
    
    НоваяСтрока = Элементы.Товары.Добавить();
    НоваяСтрока.Номер = 3;
    НоваяСтрока.Наименование = "Клавиатура Logitech";
    НоваяСтрока.Количество = 3;
    НоваяСтрока.Цена = 2500;
    НоваяСтрока.Сумма = 7500;
    
КонецПроцедуры

// Команда для передачи данных во вторую форму
&НаКлиенте
Процедура ПередатьТоварыВоВторуюФорму(Команда)
    
    // Подготавливаем структуру для передачи данных
    ТоварыДляПередачи = Новый Массив;
    
    // Копируем данные из табличной части
    Для Каждого СтрокаТаблицы Из Элементы.Товары Цикл
        
        Товар = Новый Структура;
        Товар.Вставить("Номер", СтрокаТаблицы.Номер);
        Товар.Вставить("Наименование", СтрокаТаблицы.Наименование);
        Товар.Вставить("Количество", СтрокаТаблицы.Количество);
        Товар.Вставить("Цена", СтрокаТаблицы.Цена);
        Товар.Вставить("Сумма", СтрокаТаблицы.Сумма);
        
        ТоварыДляПередачи.Добавить(Товар);
        
    КонецЦикла;
    
    // Открываем вторую форму с передачей данных
    ПараметрыФормы = Новый Структура;
    ПараметрыФормы.Вставить("Товары", ТоварыДляПередачи);
    
    ОткрытьФорму("ФормаПриемник", ПараметрыФормы, ЭтаФорма);
    
КонецПроцедуры

// Обработчик изменения данных в табличной части
&НаКлиенте
Процедура ТоварыПриИзменении(Элемент)
    // Пересчитываем сумму при изменении количества или цены
    ТекущаяСтрока = Элементы.Товары.ТекущаяСтрока;
    Если ТекущаяСтрока <> Неопределено Тогда
        ТекущаяСтрока.Сумма = ТекущаяСтрока.Количество * ТекущаяСтрока.Цена;
    КонецЕсли;
КонецПроцедуры
