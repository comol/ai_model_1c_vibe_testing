&НаКлиенте
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ТаблицаДанных = Новый ТаблицаЗначений;
	ТаблицаДанных.Колонки.Добавить(\"Артикул\");
	ТаблицаДанных.Колонки.Добавить(\"Наименование\");
	ТаблицаДанных.Колонки.Добавить(\"Описание\");
	ТаблицаДанных.Колонки.Добавить(\"ЕдиницаИзмерения\");
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьФайл(Команда)
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Диалог.ПолноеИмяФайла = ПутьКФайлу;
	Диалог.Фильтр = \"Excel файлы (*.xlsx;*.xls)|*.xlsx;*.xls\";
	
	Если Диалог.ВыбратьФайл() Тогда
		ПутьКФайлу = Диалог.ПолноеИмяФайла;
		ПрочитатьДанныеИзExcel();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьДанные(Команда)
	Если ПустаяСтрока(ПутьКФайлу) Тогда
		ПоказатьПредупреждение(, \"Необходимо выбрать файл Excel\");
		Возврат;
	КонецЕсли;
	
	Если ТаблицаДанных.Количество() = 0 Тогда
		ПоказатьПредупреждение(, \"Нет данных для загрузки\");
		Возврат;
	КонецЕсли;
	
	Попытка
		ЗагрузитьДанныеВСправочник();
		ПоказатьИнформацию(, \"Данные успешно загружены\");
	Исключение
		ПоказатьОшибку(, ОписаниеОшибки());
	КонецПопытки;
КонецПроцедуры

&НаКлиенте
Процедура ПрочитатьДанныеИзExcel()
	Попытка
		ТаблицаДанных.Очистить();
		
		// Открываем Excel файл
		Excel = Новый COMObject(\"Excel.Application\");
		Excel.Visible = Ложь;
		
		РабочаяКнига = Excel.Workbooks.Open(ПутьКФайлу);
		Лист = РабочаяКнига.Worksheets.Item(1);
		
		// Определяем диапазон данных
		ПоследняяСтрока = Лист.Cells.SpecialCells(11).Row; // xlCellTypeLastCell = 11
		
		// Читаем данные начиная со второй строки (первая - заголовки)
		Для Строка = 2 По ПоследняяСтрока Цикл
			НоваяСтрока = ТаблицаДанных.Добавить();
			НоваяСтрока.Артикул = Лист.Cells.Item(Строка, 1).Value;
			НоваяСтрока.Наименование = Лист.Cells.Item(Строка, 2).Value;
			НоваяСтрока.Описание = Лист.Cells.Item(Строка, 3).Value;
			НоваяСтрока.ЕдиницаИзмерения = Лист.Cells.Item(Строка, 4).Value;
		КонецЦикла;
		
		РабочаяКнига.Close(Ложь);
		Excel.Quit();
		
	Исключение
		Если ЗначениеЗаполнено(Excel) Тогда
			Excel.Quit();
		КонецЕсли;
		ВызватьИсключение;
	КонецПопытки;
КонецПроцедуры

&НаСервереБезКонтекста
Процедура ЗагрузитьДанныеВСправочник()
	Для Каждого СтрокаДанных Из ТаблицаДанных Цикл
		
		// Проверяем существование номенклатуры по артикулу
		Запрос = Новый Запрос;
		Запрос.Текст = 
		\"ВЫБРАТЬ
		|   Номенклатура.Ссылка
		|ИЗ
		|   Справочник.Номенклатура КАК Номенклатура
		|ГДЕ
		|   Номенклатура.Артикул = &Артикул\";
		
		Запрос.УстановитьПараметр(\"Артикул\", СтрокаДанных.Артикул);
		Результат = Запрос.Выполнить();
		
		Если Результат.Пустой() Тогда
			// Создаем новую номенклатуру
			НоваяНоменклатура = Справочники.Номенклатура.СоздатьЭлемент();
			НоваяНоменклатура.Артикул = СтрокаДанных.Артикул;
			НоваяНоменклатура.Наименование = СтрокаДанных.Наименование;
			НоваяНоменклатура.Описание = СтрокаДанных.Описание;
			НоваяНоменклатура.ЕдиницаИзмерения = СтрокаДанных.ЕдиницаИзмерения;
			НоваяНоменклатура.Записать();
		Иначе
			// Обновляем существующую номенклатуру
			СуществующаяНоменклатура = Результат[0].Ссылка.ПолучитьОбъект();
			СуществующаяНоменклатура.Наименование = СтрокаДанных.Наименование;
			СуществующаяНоменклатура.Описание = СтрокаДанных.Описание;
			СуществующаяНоменклатура.ЕдиницаИзмерения = СтрокаДанных.ЕдиницаИзмерения;
			СуществующаяНоменклатура.Записать();
		КонецЕсли;
		
	КонецЦикла;
КонецПроцедуры